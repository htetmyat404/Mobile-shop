<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Prediction Demo</title>
  <style>
    body { background:#111; color:#eee; font-family:sans-serif; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    td,th { padding:6px; border:1px solid #333; text-align:center; }
    .Win { color:#4caf50; }
    .Lose { color:#f44336; }
    .level-low { color:#f44336; }
    .level-medium { color:#ffc107; }
    .level-high { color:#4caf50; }
  </style>
</head>
<body>
  <h2>AI-powered prediction (using last 2000 records)</h2>
  <div id="predictionBox"></div>
  <table id="dataTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Number</th>
        <th>Actual</th>
        <th>Predicted</th>
        <th>Result</th>
        <th>Confidence</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
  // --- Fake sample data generator (replace with real fetch) ---
  function generateData(n=2000){
    let arr=[];
    for(let i=0;i<n;i++){
      const num = Math.floor(Math.random()*10);
      const actual = num>=5 ? "BIG":"SMALL";
      arr.unshift({
        id:100000000+i,
        number:num,
        actual:actual
      });
    }
    return arr;
  }

  const history = generateData(2000);

  // --- Advanced Prediction Logic ---
  function advancedPrediction(history){
    const lastData = history.slice(0,2000);
    const total = lastData.length;
    if(total === 0) return {prediction:"BIG", confidence:50, levelClass:"level-low", levelText:"LOW"};

    // ratio helper
    function ratio(data){
      let b = data.filter(r=>r.actual==="BIG").length;
      return b/data.length;
    }

    // Sliding windows
    const r20  = ratio(lastData.slice(0,20));
    const r50  = ratio(lastData.slice(0,50));
    const r200 = ratio(lastData.slice(0,200));
    const rTotal = ratio(lastData);

    // Weighted blend
    const weighted = (r20*0.2 + r50*0.3 + r200*0.3 + rTotal*0.2);
    let prediction = weighted>=0.5 ? "BIG":"SMALL";

    // Reversal detection
    const last10 = lastData.slice(0,10).map(r=>r.actual);
    if(last10.every(v=>v==="BIG")) prediction="SMALL";
    if(last10.every(v=>v==="SMALL")) prediction="BIG";

    // Confidence calc (last 100 accuracy)
    const checkRange = history.slice(0,100);
    let correct=0;
    checkRange.forEach((r,i)=>{
      if(i<checkRange.length-1){
        const p = (ratio(checkRange.slice(i+1,i+21))>=0.5?"BIG":"SMALL");
        if(p===r.actual) correct++;
      }
    });
    let confidence = (correct/checkRange.length)*100;

    // Confidence level
    let levelClass="level-low", levelText="LOW";
    if(confidence >= 80){ levelClass="level-high"; levelText="HIGH"; }
    else if(confidence >= 60){ levelClass="level-medium"; levelText="MEDIUM"; }

    return {
      prediction,
      confidence:confidence.toFixed(1),
      levelClass,
      levelText
    };
  }

  // --- Render ---
  const result = advancedPrediction(history);
  document.getElementById("predictionBox").innerHTML =
    `<strong>Prediction:</strong> <span class="${result.levelClass}">${result.prediction}</span>
     <span class="${result.levelClass}">(${result.levelText} - Confidence: ${result.confidence}%)</span>`;

  // Fill table with sample
  const tbody=document.querySelector("#dataTable tbody");
  history.slice(0,20).forEach(r=>{
    const predicted=result.prediction;
    const res=(predicted===r.actual)?"Win":"Lose";
    const row=`<tr>
      <td>${r.id}</td>
      <td>${r.number}</td>
      <td>${r.actual}</td>
      <td>${predicted}</td>
      <td class="${res}">${res}</td>
      <td>${result.confidence}%</td>
    </tr>`;
    tbody.innerHTML+=row;
  });
  </script>
</body>
</html>
